{% macro renderIntegrationConnectionFormJS(form, formSelector, csrfTokenFieldFillName) %}
    {% set fieldsToSendOnChannelChange = [
        form.channel.vars.full_name
    ] %}
    {% if csrfTokenFieldFillName is defined %}
        {% set fieldsToSendOnChannelChange = fieldsToSendOnChannelChange|merge([csrfTokenFieldFillName]) %}
    {% elseif form._token is defined %}
        {% set fieldsToSendOnChannelChange = fieldsToSendOnChannelChange|merge([form._token.vars.full_name]) %}
    {% endif %}

    <script type="text/javascript">
        require(['orodotmailer/js/integration-connection'], function (IntegrationConnection) {
            "use strict";

            $(function () {
                var options = {
                    formSelector: '#{{ formSelector|default(form.vars.id) }}',
                    channelSelector: '#{{ form.channel.vars.id }}',
                    fieldsSets:            {
                        channel: {{ fieldsToSendOnChannelChange|json_encode|raw }}
                    }
                };

                new IntegrationConnection(options);
            });
        });
    </script>
{% endmacro %}
